# Console chat (Консольный чат)
## Список участников команды:
Tvaryuga - Маским
## Описание работы чата
При проектировании консольного чата была выбрана идея использования двух классов Dialog и User.
Первый класс Dialog содержит данные и методы для диалога в чате (текст сообщения, время, имя 
собеседника, колличество сообщений). Второй класс User описывает данные и методы пользователя (имя,
логин, пароль, массив диалогов, количество диалогов и др.). 
В функции main создаётся массив пользователей чата. В отдельные функции были вынесены: регистрация 
пользователя, вход в аккаунт, шаблонная функция проверки ввода, изменение пользователем своих данных, 
функция выбора и функции вывода меню входа и меню аккаунта. 
Далее приведены описания классов и некоторых отдельных функций.

## Класс Dialog
### Класс содержит в себе следующие данные:
* Message - структура, описывающая данные сообщения: текст сообщения, время отправки, автор сообщения) 
* messages_ - массив структур для хранения истории сообщений в диалоге
* nameCompanion_ - имя собеседника, по умолчанию "all" (общий чат)
* countMessages_ - количество сообщений

### Методы класса
1. Конструкторы и деструктор
* `Dialog()` - конструктор по умолчанию
* `Dialog(const Message, const string nameCompanion = "all")` - конструктор, инициализирующий диалог
первым сообщением
* `Dialog(Dialog&)` - конструктор копирования
* `~Dialog()` - деструктор
2. Геттеры
* `getNameCompanion()` - вернуть имя собеседника
* `getCountMessages()` - вернуть количество сообщений в диалоге
3. Сеттер
* `setNameCompanion(const string)` - задать имя собеседника
4. Остальные методы
* `operator[](int)` - доступ к сообщению в массиве структур сообщений
* `addMessage(Message&)` - добавление сообщения в массив сообщений. В функции выделяется память для 
добавления нового сообщения
* `showHistoryMessages()` -  вывод истории сообщений в диалоге. Для вывода времени используется стандартная 
функция asctime(), которая преобразует ранее переданную инофрмацию о времени в стандартный формат времени
и даты
* `operator=(const Dialog&)` - оператор присваивания копированием

## Класс User
### Данные класса
* name_ - имя пользователя
* login_ - логин
* password_ - пароль
* pDialogs_ - массив диалогов текущего пользователя
* pGeneralChat - указатель на общий чат, для текущего пользователя
* countUsers_ - статическая целочисленная переменная хранящая количество пользователей
* countDialogs_ - количество диалогов с другими пользователями
### Методы класса
1. Конструкторы и деструкторы
* `User()` - конструктор по умолчанию
* User(string&, strung&, string&) - конструктор, инициализирующий имя, логин и пароль.
* `~User()` - деструктор
2. Геттеры
* `getName()` - вернуть имя
* `getLogin()` - вернуть логин
* `getPassword()` - вернуть пароль
* `getCountDialogs()` - вернуть количество диалогов
* `getCountUsers()` - вернуть количество пользователей
3. Сеттеры
* `setName(const string&)` - задать имя
* `setLogin(const string&)` - задать логин
* `setPassword(const string&)` - задать пароль
4. Остальные методы
* `showDialogs()` - вывести какие есть диалоги
* `showMessages()` - вывести историю сообщений общего чата
* `showMessages(const string)` - вывести историю сообщений диалога с пользователем, имя которого \
передан в аргументе
* `recieveMessage(Dialog::Message&, string recipient = "all")` - получить сообщение.
recipient - получатель сообщения, по умолчанию общий чат
* `sendMessageTo(User*, string&, const bool all = false)` - отправить сообщение пользователю, указатель
на которого передан в параметре. Текст сообщения также передан в параметре.
all - переключатель, если all = true, то отправить в общий чат.

## Описание работы функции main и других функций
### main
Как уже было замечено в самом начале создаётся указатель на память, в которую добавляются данные
зарегестрированных пользователей.
Основной цикл while, который и отвечает за непрерывную работу чата. Далее в меню пользователь выбирает
зарегестрироваться или войти в чат. Оба этих действия были вынесены в отдельные функции, для удобства.
После регистрации и входа в аккаунт появляется меню, в котором можно выбрать дальнейшие действия:
* My account - посмотреть или изменить личные данные
* Dialogs - открыть диалоги
* Send message to user - отправить сообщение другому пользователю. Этот пункт меню примечателен тем, что
можно отправить сообщение любому пользователю чата. Даже тому, с которым пока нет диалога.
* Sign out - разлогиниться

Наиболее интересный пункт это Dialogs. Поэтому разберём его подробнее.
С самого начала диалогов у нас нет, если мы ещё никому не отправляли сообщений, кроме пункта 
"all" (общий чат), который доступен сразу. Сразу стоит отметить, что если кто-то уже писал 
сообщения в общий чат, то пользователь, который зарегестрировался после этого, не увидит ранее 
написанные сообщения в общем чате. Если мы отправим сообщение в пункте "send message to user" другому 
пользователю, то у нас появится с ним диалог, в котором уже можно общаться, не заходя снова в пункт
"send message to user".

### registration
Функция имеет прототип: `void registration(User*& user)`. Следовательно в неё передаётся указатель на всех
пользователей. Знак & нужен для того, чтобы можно было изменить(добавить) данные.
В самом начале регистрации вводится имя, логин, пароль. Далее идёт проверка на совпадение введённых 
данных с данными уже существующих пользователей. При совпадении, предлагается изменить введённые данные.
Если нет совпадений, то выделяется память. При отсутствии других пользователей просто выделяется память
для первого юзера(можно изменить и выделять память сразу для нескольких пользователей):
```
 if (user == nullptr)
    {
        user = new User[1];                                                                         // Выделяем память для первого пользователя
        user[0].setName(name);
        user[0].setLogin(login);
        user[0].setPassword(password);
    }
    else
    {
        User* oldUsers = user;
        int countUsers = user->getCountUsers();
        try
        {
            user = new User[countUsers + 1];                                                        // Выделяем память с учётом добавления нового пользователя
        }
        catch (std::bad_alloc& ba)
        {
            cout << "bad_alloc caught!" << endl;
            cout << ba.what() << endl;
        }
        for (int i(0); i < countUsers; i++)
            user[i] = oldUsers[i];                                                                  // перезаписываем старых пользователей в новую, только что выделенную, память 
        delete[] oldUsers;
        user[countUsers].setName(name);
        user[countUsers].setLogin(login);
        user[countUsers].setPassword(password);
    }
```

### signingIn
Функция имеет следующий протатип: `int signingIn(User* user)`. Эта функция отвечает за вход пользоватля
в свой аккаунт. В ней происходит ввод логина и пароля и их проверка на совпадение в массиве пользователей,
который передан в аргументе. Если проверка логин и пароль корректные, то функция возвращает индекс 
этого пользователя и с ним продолжается работа в функции main, иначе возвращается -1 и в main происходит
возврат в меню входа/регистрации.
В функции signingIn
```
 for (int i(0); i < user->getCountUsers(); i++)
            if (user[i].getLogin() == login)
                if (user[i].getPassword() == password)                                              // Если логин и пароль совпадают с уже зарегестрированными, 
                {   
                    return i;                                                                       // то возвращаем индекс пользователя с этим логином и паролем
                }                                                                                   
        cout << "Wrong login or password! Try again?(y/n)\n";                                       // Если не совпадают, то попытаться снова, либо вернуться в меню регистрации/входа
        if (yesOrNot())
            continue;
        else
            return -1;
```
В функции main
```
i = signingIn(users);                                                               // функция signinIn вернёт индекс пользователь если вход успешен или -1 если нет
if (i >= 0)                                                                         // вход успешно выполнен
{
...
}
else
  choice = -1;
```
### changeAccount
Функция имеет протатип: `void changeAccount(User*& user, const int i)`. В качестве аргументов 
передаётся массив пользователей и индекс текущего пользователя.
Здесь выводятся личные данные пользователя а также есть возможность изменения пользователем 
своих личных данных: имя, логин и пароль. В функции при изменении своих данных происходит
проверка на совпадение с уже существующими данными других пользователей. При совпадении
программа сообщает, что имя/логин/пароль уже заняты и возвращается в меню этой функции, 
т.к. действие происходит в цикле while. Для выхода из функции есть кнопка "4.Back". 
При нажатии "4" происходит выход из функции.

Меню функции:
```
cout << "***\tMy profile\t***\n\n";
cout << "Name: " << user[i].getName() << endl;
cout << "Login: " << user[i].getLogin() << endl;
cout << "Password: " << user[i].getPassword() << endl;
cout << "1. Change Name\n";
cout << "2. Change Login\n";
cout << "3. Change Password\n";
cout << "4. Back\n";
```
## Примечание
В проекте была использована библиотека времени <ctime> для использования функции asctime(), localtime() и time_t с целью сохранения времени отправки сообщенияв истории сообщений диалога.


